#!/bin/bash
# test_04_revoked
# Test #4: Revoked Certificate with CRL Check

openssl s_client -connect localhost:4443 \
  -servername revoked.example.com \
  -CAfile ca-chain.pem \
  -CApath crl \
  -crl_check_all \
  -brief \
  <<< "Q" 2>&1

EXIT_CODE=$?

# Expected: exit code non-zero (verification failure for revoked cert)
if [ $EXIT_CODE -ne 0 ]; then
  exit 0  # PASS: Revoked certificate was rejected
else
  echo "Description: Revoked certificate was incorrectly ACCEPTED"
  exit 1  # FAIL
fi
